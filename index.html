<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>教學小工具｜版面優化版</title>
<style>
@font-face{
  font-family:'BpmfGenSenRoundedB';
  src:url('./BpmfGenSenRounded-B.ttf') format('truetype');
  font-weight:700;
  font-style:normal;
  font-display:swap;
}
:root{
  --bg:#f6f7fb;--panel:#fff;--primary:#2563eb;
  --yellow:#ffcc33;--purple:#a066ff;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'BpmfGenSenRoundedB',"Noto Sans TC","Microsoft JhengHei",system-ui,Arial,sans-serif;
  background:var(--bg);
}
.container{max-width:1280px;margin:32px auto;padding:24px;}
.grid{display:grid;gap:24px;}
@media(min-width:960px){.grid{grid-template-columns:240px 1fr}}

.card{
  background:var(--panel);
  border-radius:16px;
  box-shadow:0 8px 24px rgba(0,0,0,.06);
  padding:24px;
}
.card.left{
  display:flex;
  flex-direction:column;
  justify-content:center;
}
.card.left h2{
  text-align:center;
  margin:0 0 16px;
  font-size:22px;
}

.badge{
  display:flex;
  align-items:center;
  justify-content:center;
  height:70px;
  border-radius:14px;
  background:#eef2ff;
  font-weight:800;
  font-size:30px;
  border:2px dashed #c7d2fe;
}
.btn{
  border:none;
  padding:14px 18px;
  border-radius:12px;
  font-weight:700;
  cursor:pointer;
  transition:.15s;
  font-family:'BpmfGenSenRoundedB',"Noto Sans TC";
  box-shadow:0 3px 10px rgba(0,0,0,.1);
  color:#111;
  font-size:18px;
}
.btn.primary{background:var(--primary);color:#fff;}
.btn.ghost{background:#e5e7eb;color:#111;}
.btn.red{background:#ef4444;color:#fff;}
.btn.blue{background:#2563eb;color:#fff;}
.btn.yellow{background:var(--yellow);color:#000;}
.btn.purple{background:var(--purple);color:#fff;}
.btn.wide{display:block;width:100%;padding:16px 20px;font-size:20px;border-radius:16px;}
.btn .label-circle{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  background:#fff;
  width:46px;
  height:46px;
  border-radius:50%;
  font-weight:800;
  font-size:18px;
  box-shadow:0 2px 6px rgba(0,0,0,.12);
}

.progress{
  width:100%;
  height:8px;
  background:#eef2ff;
  border-radius:999px;
  overflow:hidden;
  margin-top:10px;
}
.progress>span{
  display:block;
  width:0;
  height:100%;
  background:#6366f1;
  transition:width .06s linear;
}

/* ===================== */
.stage{
  position:relative;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:24px;
  min-height:640px;
  padding:24px 16px 40px;
  border:2px dashed #e5e7eb;
  border-radius:14px;
  background:#fafafa;
}
.prompt{
  font-size:28px;
  font-weight:700;
  text-align:center;
  margin-top:10px;
  min-height:60px;
}
.canvas{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:80px;
  width:100%;
  max-width:1000px;
  min-height:360px;
  margin:10px 0 20px;
}
.label{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  width:44px;height:44px;
  border-radius:50%;
  background:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
  font-size:18px;
  color:#111;
  box-shadow:0 2px 6px rgba(0,0,0,.12);
}
.rect{position:relative;display:flex;align-items:center;justify-content:center;border-radius:10px;}
.rect.red{background:#ef4444}
.rect.blue{background:#2563eb}
.answers{
  display:flex;
  gap:20px;
  flex-wrap:wrap;
  justify-content:center;
  margin-top:10px;
}
.overlay{
  position:absolute;inset:0;
  display:none;align-items:center;justify-content:center;
  background:rgba(255,255,255,.92);
  border-radius:10px;
  z-index:5;text-align:center;
}
.overlay.show{display:flex}
.icon{width:96px;height:96px;border-radius:50%;margin-bottom:12px;}
.icon.circle{border:6px solid #10b981;}
.icon.cross{border:6px solid #ef4444;position:relative;}
.icon.cross::before,.icon.cross::after{
  content:"";position:absolute;top:50%;left:50%;
  width:48px;height:6px;background:#ef4444;transform-origin:center;
}
.icon.cross::before{transform:translate(-50%,-50%) rotate(45deg);}
.icon.cross::after{transform:translate(-50%,-50%) rotate(-45deg);}
.control-bar{
  display:flex;
  justify-content:center;
  gap:16px;
  margin-top:30px;
}
.hidden{display:none !important;}
.imgBox{
  position:relative;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:10px;
  overflow:hidden;
  background:#fff;
}
.imgBox img{
  display:block;
  width:100%;
  height:100%;
  object-fit:contain;
  background:#fff;
}
</style>
</head>
<body>
<div class="container">
  <div class="grid">
    <section class="card left">
      <h2>抽號器</h2>
      <div class="badge" id="ticket">—</div>
      <div class="progress"><span id="progressBar"></span></div>
      <div style="text-align:center;margin-top:12px;">
        <button class="btn primary" id="drawBtn">抽號碼</button>
        <button class="btn ghost" id="resetBtn">清空</button>
      </div>
    </section>

    <section class="card">
      <div class="stage">
        <div class="overlay" id="overlay"></div>
        <div class="prompt" id="prompt">按「抽題」開始</div>
        <div class="canvas" id="canvas"></div>
        <button class="btn ghost wide hidden" id="prepBtn">完成操作</button>
        <div class="answers hidden" id="answers">
          <button class="btn" id="btnA">A</button>
          <button class="btn" id="btnB">B</button>
        </div>
        <div class="control-bar">
          <button class="btn ghost" id="idleBtn">抽題</button>
          <button class="btn ghost hidden" id="backBtn">返回抽題</button>
        </div>
      </div>
    </section>
  </div>
</div>

<script>
const $=s=>document.querySelector(s);
let audioCtx=null,tickTimer=null;
function ctx(){return audioCtx||(audioCtx=new(window.AudioContext||window.webkitAudioContext)());}
document.addEventListener('click',()=>{try{ctx().resume();}catch{}},{once:true});

function startSlotRolling(){
  const C=ctx();
  const whoop=C.createOscillator(),g=C.createGain();
  whoop.type='triangle';
  whoop.frequency.setValueAtTime(260,C.currentTime);
  whoop.frequency.exponentialRampToValueAtTime(900,C.currentTime+3);
  g.gain.setValueAtTime(0.08,C.currentTime);
  whoop.connect(g).connect(C.destination);
  whoop.start();setTimeout(()=>whoop.stop(),3000);
  tickTimer=setInterval(()=>{
    const o=C.createOscillator(),gg=C.createGain();
    o.type='sine';
    const f=[880,988,1047,1175,1319][Math.floor(Math.random()*5)];
    o.frequency.value=f;
    o.connect(gg).connect(C.destination);
    const t=C.currentTime;
    gg.gain.setValueAtTime(0,t);
    gg.gain.linearRampToValueAtTime(0.15,t+0.01);
    gg.gain.exponentialRampToValueAtTime(0.0008,t+0.10);
    o.start(t);o.stop(t+0.12);
  },120);
  setTimeout(()=>{clearInterval(tickTimer);playKaChing();},3000);
}
function playKaChing(){[[1600,0.18,0.22],[1200,0.14,0.18],[900,0.16,0.18]].forEach((t,i)=>{setTimeout(()=>beep(...t),i*120);});}
function beep(f=880,d=0.12,v=0.16){const C=ctx(),o=C.createOscillator(),g=C.createGain();o.type='sine';o.frequency.value=f;g.gain.value=v;o.connect(g).connect(C.destination);const t=C.currentTime;o.start(t);o.stop(t+d);}
function success(){beep(880,0.12);setTimeout(()=>beep(1175,0.14),150);}
function fail(){beep(300,0.1,0.18);setTimeout(()=>beep(240,0.12,0.18),160);}

const ticketEl=$('#ticket'),bar=$('#progressBar'),drawBtn=$('#drawBtn'),resetBtn=$('#resetBtn');
drawBtn.onclick=()=>{const D=3000,t0=performance.now();startSlotRolling();const timer=setInterval(()=>{const p=Math.min((performance.now()-t0)/D,1);ticketEl.textContent=Math.floor(2+Math.random()*25);bar.style.width=(p*100)+'%';if(p>=1){clearInterval(timer);ticketEl.textContent=Math.floor(2+Math.random()*25);}},60);};
resetBtn.onclick=()=>{ticketEl.textContent='—';bar.style.width='0';};

const promptEl=$('#prompt'),canvas=$('#canvas'),answers=$('#answers'),
btnA=$('#btnA'),btnB=$('#btnB'),idleBtn=$('#idleBtn'),backBtn=$('#backBtn'),overlay=$('#overlay'),prepBtn=$('#prepBtn');
const ORDER=['rect','img1','tri','img2'];
let orderIndex=0,answered=false,correctBtn='B';

function setIdle(){promptEl.textContent='按「抽題」開始';canvas.innerHTML='';answers.classList.add('hidden');prepBtn.classList.add('hidden');idleBtn.classList.remove('hidden');backBtn.classList.add('hidden');answered=false;btnA.disabled=false;btnB.disabled=false;}
function startNext(){if(orderIndex>=ORDER.length)orderIndex=0;const type=ORDER[orderIndex++];answered=false;btnA.disabled=false;btnB.disabled=false;promptEl.textContent='哪個圖形更大';idleBtn.classList.add('hidden');backBtn.classList.add('hidden');
if(type==='rect'){renderRect();}
else if(type==='tri'){renderTri();}
else if(type==='img1'){renderImg('yue.jpg','se.jpg','月曆紙','色紙',true);}
else{renderImg('xuan.jpg','b.jpg','宣傳單','筆記紙',true);}
}
function enterImagePrep(){answers.classList.add('hidden');prepBtn.classList.remove('hidden');prepBtn.onclick=()=>{prepBtn.classList.add('hidden');answers.classList.remove('hidden');};}

function renderRect(){
  canvas.innerHTML='';
  btnA.className='btn red'; btnB.className='btn blue';
  btnA.innerHTML='<span class="label-circle">A</span>'; btnB.innerHTML='<span class="label-circle">B</span>';
  answers.classList.remove('hidden'); prepBtn.classList.add('hidden');
  correctBtn='B';
  const A=document.createElement('div');A.className='rect red';A.style.width='120px';A.style.height='90px';A.innerHTML='<span class="label">A</span>';
  const B=document.createElement('div');B.className='rect blue';B.style.width='340px';B.style.height='230px';B.innerHTML='<span class="label">B</span>';
  canvas.append(A,B);
}
function renderTri(){
  canvas.innerHTML='';
  btnA.className='btn yellow'; btnB.className='btn purple';
  btnA.innerHTML='<span class="label-circle">A</span>'; btnB.innerHTML='<span class="label-circle">B</span>';
  answers.classList.remove('hidden'); prepBtn.classList.add('hidden');
  correctBtn='B';
  const A=triangle(160,120,'var(--yellow)','A');
  const B=triangle(340,260,'var(--purple)','B');
  canvas.append(A,B);
}
function triangle(w,h,color,label){
  const wrap=document.createElement('div');
  wrap.className='imgBox';
  wrap.style.width=w+'px'; wrap.style.height=h+'px';
  const svg=document.createElementNS('http://www.w3.org/2000/svg','svg');
  svg.setAttribute('width',w); svg.setAttribute('height',h);
  const fill=getComputedStyle(document.documentElement).getPropertyValue(color).trim()||color;
  const poly=document.createElementNS('http://www.w3.org/2000/svg','polygon');
  poly.setAttribute('points',`0,${h} ${w/2},0 ${w},${h}`);
  poly.setAttribute('fill',fill);
  svg.appendChild(poly);
  const lbl=document.createElement('span');
  lbl.className='label'; lbl.textContent=label;
  wrap.append(svg,lbl);
  return wrap;
}
function renderImg(aSrc,bSrc,aLabel,bLabel,aIsBigger){
  canvas.innerHTML='';
  btnA.className='btn ghost'; btnB.className='btn ghost';
  btnA.textContent=aLabel; btnB.textContent=bLabel;
  correctBtn=aIsBigger?'A':'B'; enterImagePrep();
  const smallW=200,smallH=150,bigW=360,bigH=260;
  let A,B;
  if(aIsBigger){
    A=makeImageBox(aSrc,bigW,bigH); B=makeImageBox(bSrc,smallW,smallH);
  }else{
    A=makeImageBox(aSrc,smallW,smallH); B=makeImageBox(bSrc,bigW,bigH);
  }
  canvas.append(A,B);
}
function makeImageBox(src,w,h){const box=document.createElement('div');box.className='imgBox';box.style.width=w+'px';box.style.height=h+'px';const img=new Image();img.src=src;box.append(img);return box;}

function showOverlay(ok){overlay.classList.add('show');overlay.innerHTML=ok?`<div><div class="icon circle"></div><div style="color:#065f46;font-size:24px;">答對了</div></div>`:`<div><div class="icon cross"></div><div style="color:#b91c1c;font-size:24px;">再想想</div></div>`;setTimeout(()=>{overlay.classList.remove('show');overlay.innerHTML='';if(ok){setIdle();}else{answers.classList.add('hidden');prepBtn.classList.add('hidden');idleBtn.classList.add('hidden');backBtn.classList.remove('hidden');}},1200);}
btnA.onclick=()=>{if(answered)return;answered=true;btnA.disabled=true;btnB.disabled=true;if(correctBtn==='A'){success();showOverlay(true);}else{fail();showOverlay(false);}};
btnB.onclick=()=>{if(answered)return;answered=true;btnA.disabled=true;btnB.disabled=true;if(correctBtn==='B'){success();showOverlay(true);}else{fail();showOverlay(false);}};
idleBtn.onclick=startNext;backBtn.onclick=setIdle;setIdle();
</script>
</body>
</html>
